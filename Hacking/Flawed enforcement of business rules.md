
Date: 2025-09-27
Tags: 
Links:  [[WSA]], [[Business Logic Vulnerabilities]]

***

## ドメイン固有の欠陥

多くの場合、ビジネスドメインやサイトの目的に特有のロジックの欠陥に遭遇します。

オンラインショップの割引機能は、ロジックの欠陥を探す際の古典的な攻撃対象領域です。これは攻撃者にとって潜在的な宝の山となる可能性があり、割引が適用される方法にはあらゆる種類の基本的なロジックの欠陥が発生します。

例えば、注文額が1000ドルを超えると10%の割引を提供するオンラインショップを考えてみましょう。もしビジネスロジックが、割引適用後に注文内容が変更されたかどうかをチェックし損ねていた場合、この機能は悪用される可能性があります。この場合、攻撃者は単にカートに商品を追加して1000ドルのしきい値に達するまで商品を入れ、その後、注文する前に不要な商品を削除することができます。そうすれば、注文がもはや意図された基準を満たしていないにもかかわらず、割引を受けることができてしまいます。

ユーザーのアクションによって決定される基準に基づいて価格やその他の機密性の高い値が調整される状況には、特に注意を払うべきです。アプリケーションがこれらの調整を行うためにどのようなアルゴリズムを使用しているか、そしてどの時点でこれらの調整が行われるかを理解しようと努めてください。これには、適用された調整が開発者の意図した元の基準に対応しないような状態にアプリケーションを操作することがしばしば含まれます。

これらの脆弱性を特定するためには、攻撃者が持ちうる目的について慎重に考え、提供されている機能を使ってこれを達成するためのさまざまな方法を見つけ出す必要があります。特定の文脈で何が有利になるかを理解するためには、ある程度のドメイン固有の知識が必要になる場合があります。簡単な例を挙げると、多数のユーザーに自分をフォローさせることの利点を理解するためには、ソーシャルメディアを理解している必要があります。

このドメイン知識がなければ、その潜在的な連鎖的影響に気づかないために、危険な挙動を見過ごしてしまうかもしれません。同様に、点と点を結びつけ、2つの機能がどのように有害な方法で組み合わされうるかに気づくのに苦労するかもしれません。簡単にするため、このトピックで使用される例は、すべてのユーザーが既によく知っているドメイン、すなわちオンラインショップに特化しています。しかし、バグバウンティハンティング、ペネトレーションテスト、あるいは単により安全なコードを書こうとしている開発者であっても、いつかはあまり馴染みのないドメインのアプリケーションに遭遇するかもしれません。その場合は、できるだけ多くのドキュメントを読み、可能であれば、そのドメインの主題専門家と話をして見識を得るべきです。これは多くの作業のように聞こえるかもしれませんが、ドメインがニッチであればあるほど、他のテスターが多くのバグを見逃している可能性が高くなります。

## Lab : 

1. 二つの割引クーポンを適用するリクエスト交互に送信するとなぜか重複せず割引される。


***
# References

https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-flawed-enforcement-of-business-rules